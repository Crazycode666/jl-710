# LLNS（低延时降噪）

## 功能介绍
低延时降噪，支持延时配置，可根据需求以及cpu资源剩余情况自行调整。

## 模块特征
- **采样率**
    - 16KHz、32kHz、44.1kHz、48kHz
- **位宽**
    - 16bit、24bit
- **通道**
  - 单通道

## 资源消耗
|Parameters|RAM(byte)|CODE(byte)|CPU(Hz)
|---|---|---|---|
|FrameSize=5ms|21k|8k|28M|
|FrameSize=2.5ms|21k|8k|37M|
|FrameSize=1ms|21k|8k|72M|
|FrameSize=0.5ms|21k|8k|132M|

## 参数介绍
* **延时** **[Delay]**：LLNS延时（范围：0.5~5ms），延时越小，计算帧长越小，需要的芯片算力越高。该值会改变计算帧长，在线调试不生效，需要重新开关模块才能生效。
* **门限** **[Gain Floor]**：调节底噪大小，值越小，底噪水平越低（范围：0~1）
* **抑制强度** **[Suppress Level]**：噪声抑制强度，值越大，抑制强度越高（范围：0~6）
* **初始噪声水平** **[Noise Level]**： 用来加速收敛，跟MIC的信噪比有关。MIC的信噪比高，该值可以小一点，反之则需要稍微大一点。如果初始噪声设置过高，则可能导致一开始声音比较小，如果过小，可能降噪收敛加速不明显。所以这个值需要根据具体的方案适当修改（范围-100~30dB）

## 注意事项
LLNS需要输入特定长度的数据进行运算。
- 运算帧长计算公式：**Delay * sample_rate**。
- 如果数据帧长与LLNS所需运算帧长不一致，会在LLNS内部进行拼拆包操作，**播放同步**节点需要配置更高的**同步延时**，同时引入更多缓存，带来更大延时。

例：LLNS参数Delay配置为5ms，数据流采样率为44.1k，则LLNS计算帧长为：5 / 1000 * 44100 = 220。<br>此时建议将数据流源节点(IIS_RX、ADC等)**中断点数**配置为220，将LLNS串在**播放同步**节点之前（防止播放同步改变数据帧长），播放同步延时根据cpu运行情况酌情配置加大（以不打印uU，声音卡顿为准），DAC节点延时需要大于等于播放同步延时。

## 使用示例
* 一般将LLNS串在通话上行、麦克风音效等流程中。一般来说，使用了LLNS后，可以去掉流程中的NoiseGate模块。
