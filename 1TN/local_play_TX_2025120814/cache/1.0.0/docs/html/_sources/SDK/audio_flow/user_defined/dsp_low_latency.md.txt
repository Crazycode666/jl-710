# 低延时DSP

## 功能介绍
在第三方算法节点内进行数据处理，可通过缓存优化尽可能地实现低延时。
![](./assets/dsp_low_latency_0.png)

## 主要接口
```c
//打开
int dsp_low_latency_player_open();
//关闭
void dsp_low_latency_player_close();
```

## 参数配置
### 中断帧长配置
数据帧长与IIS_RX的中断点数（决定每次起中断输出多少数据）有关。
每帧数据长度（单位bytes）：
- 16bit：AUDIO_IIS_IRQ_POINTS * 2 * 2 
- 24bit：AUDIO_IIS_IRQ_POINTS * 2 * 4
```c
int dsp_low_latency_player_open()
{
    ......
    //设置中断点数：AUDIO_IIS_IRQ_POINTS 在audio_config_def.h中配置
    jlstream_node_ioctl(player->stream, NODE_UUID_SOURCE, NODE_IOC_SET_PRIV_FMT, AUDIO_IIS_IRQ_POINTS);
    ......
}
```

### 播放同步配置
- **同步延时**：需要根据中断点数、采样率、第三方算法运算时间配置。
    - 例：中断点数为256点，采样率为44.1k，算法运算时间为3ms。<br>数据帧长+算法运行时间为：256/44.1+3 = 8.8ms <br>由于系统调度影响，一般会添加部分冗余，为保证系统正常运行，可配置为10ms。
- **对齐模式**：一般IIS_RX、IIS_TX为同时钟源，此时可配置为**变采样bypass**，仅做数据缓存

